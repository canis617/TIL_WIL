# 동형 렌더링(Isomorphic Rendering)

- 동형 렌더링(Isomorphic Rendering) : SSR과 CSR을 적절히 조합한 것.
  - 첫 접속은 SSR로, 그 이후 동작은 CSR로 사용

![Next 구조](https://miro.medium.com/max/682/1*b8acx4-X_Tdw6tTgP7PMTA.png)

- 클라이언트 사이드 렌더링의 장점은 있으나, 실질적인 SEO(검색 엔진 최적화) 문제로 인해 SSR로 돌아가는 경향이 보인다.

- 기존의 동형 웹 개념을 기존 기술로 적용하는 건 굉장히 어려웠다.
- 서버 내에서 자바스크립트 코드를 실행해서 렌더링을 할 수 있어야 하는데 이를 적용하기 쉽지 않았다.
- 이를 Node.js를 사용하면 어느정도 수월하게 할 수 있는데, JS 인터프리터가 별도로 필요하지도 않고 클라이언트 페이지에서나 서버에서나 같은 코드를 공유 할 수 있어, 구현과 설계가 용이해지기 때문

- 여기서 CSR의 장점을 살리면서 SSR의 프로젝트 구조를 가지게 하는것이 Next.js와 Nuxt.js이다.
- Next.js는 React.js 전용 SSR 프레임워크
- Nuxt.js는 Vue.js 전용 SSR 프레임워크

## 요약

- 프로젝트 전반적인 폴더 구조가 조금 다르지만 대체로 비슷하게 동작
- 라우터 셋업이 달라진다. 디렉토리 구조에 따라 자동생성하는 것을 디폴트로 한다.
- 개발 및 배포 환경이 조금 달라진다.
- Layout을 컴포넌트의 프로퍼티로써 사용할 수 있다.

## 동작 구조

![페이지 구조](https://miro.medium.com/max/475/1*GaFqy84iriNUQkR12XNACg.png)

- 3가지 케이스를 알아보겠다
  1. List Page > Space 1 > List Page
  1. Space 1 > List Page > Space 2
  1. Space 2 > List Page > Space 1

- 모든 페이지는 첫 접속시, 서버 사이드 렌더링으로 제공
- 컨텐츠 데이터는 하드코딩 되있으며, ajax는 페잊 구조, 써드파티 모듈 로드 시 사용

- 로직
  1. 처음 로딩시, 필요한 부분만 로딩한다. > 서버 사이드 렌더링으로 제공된다.
  1. 웹 페이지를 이동할 시, 필요한 부분만 로딩한다.
  1. 방문한 페이지를 다시 방문 시, 로딩된 부분은 로딩하지 않는다.

## Nuxt와 Next 비교

- Nuxt가 Next보다 가볍고, 간편하다? 라는 의견이 있다.
- React는 개별파일을 개별적으로 짜게 되는 경우가 더 많고, 공통적으로 사용하게 되는 컴포넌트는 아주 작은 조각이다.

## 좀 더 자세한 용어..

- 프리랜더링과 하이드레이션

```bash
브라우저 주소창으로 페이지 요청 =>
서버에서 요청에 맞는 프리랜더링 HTML 보냄 =>
브라우저에서 html받고 딸려온 자바스크립트로 하이드레이션 =>
그 다음은 SPA처럼 동작 => SSR 끗!
```

- 프리 랜더링(pre-rendering)
  - React나 Vue로 만든 기존 SPA 위에서 서버에서 브라우저로 전송할 수 있도록 어느정도 완성된 HTML 파일을 만드는 동작
  - SPA는 라우팅 역시 js로만 이루어지는데, SSR 라이브러리를 사용한 앱은 js로만 라우팅하지 않고 빌드 결과물에 작은 서버를 달아서 브라우저의 주소창으로 들어온 요청에 맞는 페이지 컴포넌트를 프리랜더링 해 브라우저에 제공하는 방식으로 라우팅

- 하이드레이션(Hydration)이란
  - 프리랜더링 과정을 마치고 브라우저로 전돨된 HTML 파일 위에 남은 자바스크립트 코드들을 실행하는 동작
  - 하이드레이션으로 인해 SSR 앱은 기존의 SPA와 같은 동작과 반응성을 보장
  - 불완전한 HTML 파일이라는 '마른 땅'에 JS라는 '물'을 뿌리는 일

- SSR의 핵심
- 여기서 SSR앱이 서버를 끼고 빌드 된다는 개념
  - SSR앱과 SPA의 배포 방식의 차이를 야기함
  - SPA의 빌드 결과물은 HTML 하나랑 자바스크립트 파일 뭉치
  - AWS S3 같은 스토리지에 빌드 결과물을 저장하고 도메인을 연결시키면 브라우저가 알아서 HTML과 JS 파일을 실행
  - SSR앱은 서버를 끼고 있으니, 스토리지에 올려놓는다고 해서 브라우저가 접근해서 실행시킬 수 있는 자원이 아니다.
  - 백엔드 서버처럼 구동할 수 있는 컴퓨팅이 필요


