# HTTP 쿠키와 세션

- 쿠키와 세션이 필요한 이유

- HTTP 프로토콜에 대한 이해
  - Connectionless 하고 stateless한 프로토콩
  - Connectionless : 클라이언트가 서버에 요청을 하고 서버가 클라이언트에게 응답을 보내면 접속을 끊는다.
  - Stateless : 통신이 끝나면 상태정보를 저장하지 않는다.

- Server가 Client를 식별할 수 있는 방법이 필요
  - 쿠키와 세션의 등장

- HTTP 는 Stateless하기 때문에 로그인 상태 정보를 유지하지 않아서 쿠키와 세션을 사용하지 않으면 게시판이나 메일을 확인할 때 페이지를 이동할 때마다 로그인 해야함

## 쿠키(Cookie)

- 쿠키는 클라이언트에 저장되는 키와 값이 들어 있는 작은 데이터 파일.
- 쿠키에는 이름, 값, 만료 날짜, 경로 정보 등이 들어있다.

- 쿠키는 일정 시간동안 데이터를 저장할 수 있어서 로그인 상태를 유지하거나 사용자 정보를 일정 시간 동안 유지해야 하는 경우에 주로 사용

- Response Header의 Set-Cookie 속성을 사용하면 클라이언트에 쿠키를 만들 수 있다.

- 만들어진 쿠키는 사용자가 요청하지 않아도 브라우저가 매번 Request Header에 넣어서 서버에 전송하게 된다.

- 사용자 정보가 클라이언트 컴퓨터에 파일로 남고 클라이언트 컴퓨터에 접근할 수 있는 사람이면 누구든지 열어 정보를 확인할 수 있어 보안상 문제가 생길 수 있다.

## 세선(Session)

- 서버 메모리에 저장되는 정도

- 서버에 저장되기 때문에 쿠키와는 달리 사용자 정보가 노출되지 않는다.

- 로그인 처리 과정
  1. 사용자가 로그인 페이지에 ID/PW 입력하고 로그인 버튼 클릭
  1. 서버에서 사용자가 보낸 ID/PW 정보를 확인하고 존재하는 사용자면 서버 메모리에 유일한 세션 ID를 생성하고, 사용자 ID와 매핑 정보를 저장
  1. 클라이언트에 세션 ID를 쿠키로 저장
  1. 요청시 마다 서버는 Request Header의 쿠키 정보(세션ID)를 확인하고 세션 ID와 매핑되는 id로 사용자를 인식

- 세션은 서버 메모리에 저장되지만 세션 역시 클라이언트에 쿠키로 저장된다는 것이 중요

- 세션을 사용해도 클라이언트의 쿠키에 저장된 세션ID를 다른 사람이 가로채서 자신의 세션ID를 가로챈 세션ID로 변조해서 사용 가능
- 세션을 사용하는 것만으로는 아직 보안에 취약.
  - IP 정볼르 함께 사용하거나 쿠키 값 변조를 확인하는 방법 등으로 보완

## 문제점

- XSS(Cross-site Scripting) 공격
  - 공격자가 javascript 문을 이용해 cookie 값을 탈취하는 방법

- 스니핑 (Sniffing) 공격
  - 암호화 되지 않은 쿠키값을 사용하는 사이트에서 스니핑 공격을 통해 쿠키 정보를 탈취

- 공용 PC에서 쿠키값 유출
  - 사용자가 웹 페이지에 이동하여 사용을 하게 되면 원치 않아도 쿠키값이 남아있음

- 호스팅 공유 문제
  - 호스팅을 공유하는 사이트를 이용하는 경우, 공유된 사이트 중 보안이 취약한 사이트를 찾아 공격하면 모든 공유 사이트들 모두 공격 당할 수 있다.

- 쿠키의 개인정보 침해 위험
  - 웹사이트의 무분별한 수집 및 안일한 보안 구축으로 인한 피해

